// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// 1. Users Table (Central Auth)
model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String?  @map("password_hash")
  role         Role
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  name         String   @db.VarChar(100)

  // Relations
  brandProfile   BrandProfile?
  creatorProfile CreatorProfile?

  // A user (Brand) can own many campaigns
  brandCampaigns Campaign[] @relation("BrandCampaigns")

  // A user (Creator) can have many collaborations
  creatorCollabs CampaignCollaboration[] @relation("CreatorCollaborations")

  // Financials and Content
  transactions   Transaction[]
  analytics      AnalyticsDaily[]
  posts          CommunityPost[]
  socialAccounts SocialAccount[]

  @@index([email])
  @@index([role])
  @@map("users")
}

// 2. Brand Profiles (One-to-One with Users)
model BrandProfile {
  userId       Int           @id @map("user_id")
  companyName  String        @map("company_name") @db.VarChar(100)
  tagline      String?       @db.VarChar(255)
  industry     String?       @db.VarChar(50)
  location     String?       @db.VarChar(100)
  about        String?       @db.Text
  logoUrl      String?       @map("logo_url") @db.VarChar(255)
  companySize  CompanySize?  @default(Startup) @map("company_size")
  hiringStatus HiringStatus? @default(Active) @map("hiring_status")
  hiringSince  Int?          @map("hiring_since") // MySQL YEAR maps to Int in Prisma usually, or check specific DB mapping
  websiteUrl   String?       @map("website_url") @db.VarChar(255)
  socialLinks  Json?         @map("social_links")
  contactEmail String?       @map("contact_email") @db.VarChar(255)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("brand_profiles")
}

// 3. Creator Profiles (One-to-One with Users)
model CreatorProfile {
  userId          Int       @id @map("user_id")
  fullName        String    @map("full_name") @db.VarChar(100)
  handle          String    @db.VarChar(50)
  tagline         String?   @db.VarChar(255)
  avatarUrl       String?   @map("avatar_url") @db.VarChar(255)
  primaryPlatform Platform? @map("primary_platform")
  location        String?   @db.VarChar(100)
  about           String?   @db.Text
  nicheTags       Json?     @map("niche_tags")
  followersCount  Int?      @default(0) @map("followers_count")
  engagementRate  Decimal?  @map("engagement_rate") @db.Decimal(5, 2)
  basePrice       Decimal?  @map("base_price") @db.Decimal(10, 2)
  socialLinks     Json?     @map("social_links")
  rating          Decimal?  @default(5.00) @db.Decimal(3, 2)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([handle])
  // Prisma doesn't strictly support functional indexes (idx_niche on JSON) in schema definition syntax 
  // uniformly across versions, but standard indexes work:
  @@index([userId], map: "idx_niche")
  @@map("creator_profiles")
}

// 4. Campaigns
model Campaign {
  id               Int             @id @default(autoincrement())
  brandId          Int             @map("brand_id")
  title            String          @db.VarChar(255)
  description      String?         @db.Text
  platformRequired String?         @map("platform_required") @db.VarChar(50)
  campaignType     String?         @map("campaign_type") @db.VarChar(50)
  status           CampaignStatus? @default(Draft)
  budgetMin        Decimal?        @map("budget_min") @db.Decimal(10, 2)
  budgetMax        Decimal?        @map("budget_max") @db.Decimal(10, 2)
  deadline         DateTime?       @db.Date
  createdAt        DateTime        @default(now()) @map("created_at")

  brand User @relation("BrandCampaigns", fields: [brandId], references: [id], onDelete: Cascade)

  collaborations CampaignCollaboration[]
  transactions   Transaction[]
  analytics      AnalyticsDaily[]

  @@index([status])
  @@map("campaigns")
}

// 5. Campaign Submissions / Collaborations
model CampaignCollaboration {
  id            Int           @id @default(autoincrement())
  campaignId    Int           @map("campaign_id")
  creatorId     Int           @map("creator_id")
  status        CollabStatus? @default(Applied)
  agreedPrice   Decimal?      @map("agreed_price") @db.Decimal(10, 2)
  submissionUrl String?       @map("submission_url") @db.VarChar(255)
  feedbackNotes String?       @map("feedback_notes") @db.Text
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  campaign Campaign @relation(fields: [campaignId], references: [id])
  creator  User     @relation("CreatorCollaborations", fields: [creatorId], references: [id])

  @@map("campaign_collaborations")
}

// 6. Financial Transactions
model Transaction {
  id              Int                @id @default(autoincrement())
  userId          Int                @map("user_id")
  campaignId      Int?               @map("campaign_id")
  amount          Decimal            @db.Decimal(10, 2)
  type            TransactionType
  status          TransactionStatus? @default(Pending)
  description     String?            @db.VarChar(255)
  transactionDate DateTime           @default(now()) @map("transaction_date")

  user     User      @relation(fields: [userId], references: [id])
  campaign Campaign? @relation(fields: [campaignId], references: [id])

  @@map("transactions")
}

// 7. Analytics Data
model AnalyticsDaily {
  id               Int      @id @default(autoincrement())
  brandId          Int      @map("brand_id")
  campaignId       Int?     @map("campaign_id")
  recordDate       DateTime @map("record_date") @db.Date
  revenueGenerated Decimal? @default(0.00) @map("revenue_generated") @db.Decimal(10, 2)
  spendAmount      Decimal? @default(0.00) @map("spend_amount") @db.Decimal(10, 2)
  impressions      Int?     @default(0)
  clicks           Int?     @default(0)

  brand    User      @relation(fields: [brandId], references: [id])
  campaign Campaign? @relation(fields: [campaignId], references: [id])

  @@index([brandId, recordDate])
  @@map("analytics_daily")
}

// 8. Community Feed / Posts
model CommunityPost {
  id          Int        @id @default(autoincrement())
  userId      Int        @map("user_id")
  type        PostType
  contentText String?    @map("content_text") @db.Text
  mediaUrl    String?    @map("media_url") @db.VarChar(255)
  mediaType   MediaType? @default(none) @map("media_type")
  createdAt   DateTime   @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id])

  @@map("community_posts")
}

// 9. Social Accounts
model SocialAccount {
  id           Int       @id @default(autoincrement())
  userId       Int       @map("user_id")
  platform     Platform
  username     String    @db.VarChar(100)
  handle       String?   @db.VarChar(100)
  profileUrl   String?   @map("profile_url") @db.VarChar(255)
  accessToken  String?   @map("access_token") @db.Text
  refreshToken String?   @map("refresh_token") @db.Text
  expiresAt    DateTime? @map("expires_at")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("social_accounts")
}

// --- ENUMS ---

enum Role {
  brand
  creator
  admin
}

enum CompanySize {
  Startup
  Mid_Market @map("Mid-Market")
  Enterprise
}

enum HiringStatus {
  Active
  Hiring
  Paused
}

enum Platform {
  Instagram
  TikTok
  YouTube
  Twitch
  Twitter
  Other
}

enum CampaignStatus {
  Draft
  Active
  Completed
  Paused
}

enum CollabStatus {
  Applied
  Invited
  In_Progress  @map("In Progress")
  Under_Review @map("Under Review")
  Revision
  Approved
  Paid
}

enum TransactionType {
  Deposit
  Payment
  Withdrawal
  Refund
}

enum TransactionStatus {
  Pending
  Completed
  Failed
}

enum PostType {
  Casting_Call @map("Casting Call")
  Showcase
  General
}

enum MediaType {
  image
  video
  none
}
